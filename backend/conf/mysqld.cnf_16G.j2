[mysqld]
port                            = 3306
socket                          = /var/run/mysqld/mysqld.sock
pid-file                        = /var/run/mysqld/mysqld.pid
datadir                         = /var/lib/mysql
log-error                       = /var/log/mysql/mysql-error.log
tmpdir                          = /tmp

# Disabling symbolic-links is recommended to prevent assorted security risks
symbolic-links=0

# binlog setting
log-bin                         = mysql-bin

#binlog_format                   = MIXED      # can be mixed, decrease ..
binlog_format                   = ROW      # can be mixed, decrease ..
binlog_row_image                = minimal


#sync_binlog                     = 1  # default 0    affect performanceï¼Œ
                                      # safe to guarantee replication
slave_net_timeout               = 60 # defacult 3600

expire_logs_days                = 7
relay_log                       = mysql-relay
server_id                       = {{server_id | default('555')}}
log_bin_trust_function_creators = 1
wait_timeout                    = 57600
interactive_timeout             = 57600


max_allowed_packet              = 256M # or 100M
event_scheduler                 = 1
max_connections                 = {{max_connections | default('2000')}}

# log setting {slow query, not using indexs}
slow_query_log                  = {{slow_query_log | default('0')}}
slow_query_log_file             = mysql-slow.log
long_query_time                 = {{long_query_time | default('0.20')}}
log_queries_not_using_indexes   = {{log_queries_not_using_indexes | default('0')}}

# character
character-set-server            = utf8mb4

# tx
transaction-isolation		        = REPEATABLE-READ #REPEATABLE-READ req for ACID, SERIALIZABLE req XA

# innodb
innodb_buffer_pool_size         = {{innodb_buffer_pool_size | default('10G')}}
                                  # old 128M, 70%-80% mache mem
innodb_log_file_size            = 500M # old 500M, total 1G,  can bigger to 1024M
                                       # Note: modify need to move old file to other position,may start fail
                                       # 64G_RAM+ = 768, 24G_RAM+ = 512, 8G_RAM+ = 256, 2G_RAM+ = 128
#innodb_log_files_in_group       = 2 # defacult 2
innodb_log_buffer_size          = 32M  # defalut 8M
innodb_buffer_pool_instances    = 8    # default
innodb_flush_log_at_trx_commit  = 2 # defalut 1, per second trx flush  2/0 = perf, 1 = ACID
innodb_file_per_table           = 1
innodb_lock_wait_timeout        = 60  # timeout 500
innodb_status_output            = ON
innodb_status_output_locks      = ON
innodb_print_all_deadlocks      = ON
innodb_read_io_threads          = 6  # default 4
innodb_write_io_threads         = 6  # default 4
#innodb_thread_concurrency       = 16 # default 0  recommend 2x core quantity
#innodb_additional_mem_pool_size = 8M #default 8M
#innodb_open_files               = 2000  # default 2000, can open *.idb file count
# buffer setting
sort_buffer_size                = 1M # default 0.25M
join_buffer_size                = 1M # default 0.25M,     can bigger to 128M
read_buffer_size                = 1M # default 0.125M
read_rnd_buffer_size            = 1M # default 0.25M
#max_length_for_sort_data        = 1024 # default 1024
#max_connect_errors              = 100 # defacult 100
#innodb_doublewrite              = 1 # default on
#thread_concurrency              = 12  # default 10    recommend 2x CPU cores
#thread_cache_size               = 28 # defacult 28    recommend 5% of max_connections
#open_files_limit                = 1048576 # default 1048576

# MyISAM
#key_buffer_size                 = 32M   # default 8M
#query_cache_size                = 1M # default 1M

# table size
tmp_table_size                  = 128M  # default 16M
max_heap_table_size             = 128M  # default 16M recommend same size as tmp_table_size

# concat
group_concat_max_len            = 100000000

[mysql]
default-character-set           = utf8mb4

[client]
default-character-set           = utf8mb4

[mysqldump]
quick
quote-names
max_allowed_packet 		= 128M